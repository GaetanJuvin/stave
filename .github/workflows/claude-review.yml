name: Claude PR Review

on:
  pull_request:
    types: [opened, synchronize, reopened]

permissions:
  contents: read
  pull-requests: write

jobs:
  architecture-lint:
    name: Architecture Lint
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Run architecture linter
        run: |
          chmod +x scripts/lint-architecture.sh
          ./scripts/lint-architecture.sh

  claude-review:
    name: Claude Code Review
    runs-on: ubuntu-latest
    needs: architecture-lint
    # Uncomment when you have Claude Code CI set up:
    # if: github.event.pull_request.draft == false
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Get PR diff
        id: diff
        run: |
          git diff origin/${{ github.base_ref }}...HEAD > /tmp/pr-diff.txt
          echo "diff_size=$(wc -l < /tmp/pr-diff.txt)" >> $GITHUB_OUTPUT

      # Option 1: Use Claude Code CLI for review
      # Uncomment and configure when ready:
      #
      # - name: Install Claude Code
      #   run: npm install -g @anthropic-ai/claude-code
      #
      # - name: Run Claude Review
      #   env:
      #     ANTHROPIC_API_KEY: ${{ secrets.ANTHROPIC_API_KEY }}
      #   run: |
      #     claude -p "Review this PR diff for:
      #       1. Architecture violations (see ARCHITECTURE.md)
      #       2. Security issues (see docs/SECURITY.md)
      #       3. Convention violations (see docs/DESIGN.md)
      #       4. Missing tests
      #       5. Code quality issues
      #
      #       Diff:
      #       $(cat /tmp/pr-diff.txt)
      #
      #       Output a structured review with: summary, issues (with severity), and recommendation."

      # Option 2: Use GitHub Actions Claude integration
      # See: https://docs.anthropic.com/en/docs/claude-code/github-actions
      #
      # - name: Claude Review
      #   uses: anthropics/claude-code-action@v1
      #   with:
      #     anthropic_api_key: ${{ secrets.ANTHROPIC_API_KEY }}

      - name: Review placeholder
        run: |
          echo "Claude review step is configured but not yet active."
          echo "Uncomment the appropriate review option in .github/workflows/claude-review.yml"
          echo "PR diff is ${{ steps.diff.outputs.diff_size }} lines"
